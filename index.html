<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checklist de FiscalizaÃ§Ã£o â€” ARGOS</title>
  <link rel="stylesheet" href="argos.css">
  <script>
    // Firewall de autenticaÃ§Ã£o - verifica login antes de carregar a pÃ¡gina
    (function() {
      const isLoggedIn = sessionStorage.getItem('argos_logged_in');
      if (isLoggedIn !== 'true') {
        window.location.href = 'login.html';
      }
    })();
  </script>
</head>
<body>
  <script>
    // Verificar tipo de usuÃ¡rio e aplicar permissÃµes
    const userType = sessionStorage.getItem('argos_tipo');
    const isFiscal = userType === 'fiscal';
    
    // Se for fiscal, desabilita ediÃ§Ã£o apÃ³s o carregamento
    if (isFiscal) {
      document.addEventListener('DOMContentLoaded', () => {
        // Bloquear inputs
        document.querySelectorAll('input, textarea, select').forEach(el => {
          el.disabled = true;
          el.style.cursor = 'not-allowed';
          el.style.opacity = '0.6';
          el.style.pointerEvents = 'none';
        });
        
        // Bloquear botÃµes de resposta completamente
        document.querySelectorAll('.answer-btn').forEach(btn => {
          btn.disabled = true;
          btn.style.cursor = 'not-allowed';
          btn.style.opacity = '0.5';
          btn.style.pointerEvents = 'none';
          // Remover eventos onclick
          btn.removeAttribute('onclick');
        });
        
        // Ocultar botÃµes de aÃ§Ã£o (salvar, limpar, etc)
        const actionsToHide = [
          'saveRecord', 'resetChecklist', 'getGeolocation'
        ];
        document.querySelectorAll('button').forEach(btn => {
          const onclick = btn.getAttribute('onclick');
          if (onclick && actionsToHide.some(action => onclick.includes(action))) {
            btn.style.display = 'none';
          }
        });
        
        // Adicionar badge de modo visualizaÃ§Ã£o proeminente
        const headerInfo = document.querySelector('.header-info');
        if (headerInfo) {
          const badge = document.createElement('div');
          badge.style.cssText = 'background:linear-gradient(135deg,#ff9800,#ff5722);color:#fff;padding:14px 20px;border-radius:12px;margin-top:12px;text-align:center;font-weight:700;font-size:15px;box-shadow:0 4px 20px rgba(255,152,0,0.4);border:2px solid rgba(255,255,255,0.2)';
          badge.innerHTML = 'ğŸ”’ MODO SOMENTE LEITURA - VocÃª nÃ£o pode editar ou responder este checklist (UsuÃ¡rio: Fiscal)';
          headerInfo.appendChild(badge);
        }
        
        // Modificar tÃ­tulo da pÃ¡gina
        document.querySelector('.name').textContent = 'VisualizaÃ§Ã£o do Checklist';
        
        // Bloquear inputs de arquivos
        document.querySelectorAll('input[type="file"]').forEach(input => {
          input.disabled = true;
          input.style.display = 'none';
        });
      });
    }
  </script>
  <div class="container">
    <aside class="profile card">
      <div class="avatar">
        <img src="arg/Logo-Argosvig-2-e1745505100362.webp" alt="Logo ARGOS" style="width:100%;height:100%;object-fit:contain;border-radius:12px;">
      </div>

      <nav style="margin-top:16px">
        <div id="user-type-badge" style="background:rgba(0,212,255,0.15);color:#00d4ff;padding:8px 12px;border-radius:8px;margin-bottom:12px;text-align:center;font-size:12px;font-weight:600;border:1px solid rgba(0,212,255,0.3)"></div>
        <a href="index.html" class="nav-link active">ğŸ“‹ FiscalizaÃ§Ã£o</a>
        <a href="registros.html" class="nav-link">ğŸ“Š Registros</a>
        <button onclick="logout()" class="nav-link" style="width:100%;text-align:left;background:rgba(255,94,94,0.1);color:#ff5e5e;border:none;cursor:pointer;padding:10px 16px;border-radius:8px;font-size:14px;font-weight:500;margin-top:8px;">ğŸšª Sair</button>
      </nav>

      <script>
        // Exibir tipo de usuÃ¡rio
        const userTypeBadge = document.getElementById('user-type-badge');
        const userName = sessionStorage.getItem('argos_user');
        const currentUserType = sessionStorage.getItem('argos_tipo');
        if (userTypeBadge) {
          if (userType === 'admin') {
            userTypeBadge.innerHTML = 'ğŸ‘¤ ' + (userName || 'Admin').toUpperCase() + ' - ADMINISTRADOR';
            userTypeBadge.style.background = 'rgba(0,230,118,0.15)';
            userTypeBadge.style.color = '#00e676';
            userTypeBadge.style.borderColor = 'rgba(0,230,118,0.3)';
          } else {
            userTypeBadge.innerHTML = 'ğŸ‘ï¸ ' + (userName || 'Fiscal').toUpperCase() + ' - FISCAL (LEITURA)';
            userTypeBadge.style.background = 'rgba(255,152,0,0.15)';
            userTypeBadge.style.color = '#ff9800';
            userTypeBadge.style.borderColor = 'rgba(255,152,0,0.3)';
          }
        }
      </script>

      <div class="card">
        <h3 class="section-title"><span>InformaÃ§Ãµes da Vistoria</span></h3>
        <div style="margin-top:12px">
          <label for="inspector" style="display:block;font-weight:600;font-size:13px;color:#000000;margin-bottom:6px">ğŸ‘¤ Inspetor de Checklist</label>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px">
            <input type="text" id="inspector" placeholder="Nome do responsÃ¡vel" list="inspector-datalist" style="flex:1">
            <button type="button" title="Adicionar inspetor" onclick="addInspectorPrompt()" aria-label="Adicionar inspetor" style="padding:6px 10px;background:#00bcd4;color:white;border:none;border-radius:6px;cursor:pointer;margin-right:4px">ï¼‹</button>
            <button type="button" id="clear-inspector" title="Limpar responsÃ¡vel" aria-label="Limpar responsÃ¡vel" style="padding:6px 10px;background:#ff5e5e;color:white;border:none;border-radius:6px;cursor:pointer;">âœ–</button>
          </div>
          <datalist id="inspector-datalist"></datalist>
          <label for="location" style="display:block;font-weight:600;font-size:13px;color:#000000;margin-bottom:6px;margin-top:4px">ğŸ¢ Centro de Custo</label>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px">
            <input type="text" id="location" placeholder="Local da fiscalizaÃ§Ã£o" list="location-datalist" style="flex:1">
            <button type="button" title="Adicionar centro de custo" onclick="addLocationPrompt()" aria-label="Adicionar centro de custo" style="padding:6px 10px;background:#00bcd4;color:white;border:none;border-radius:6px;cursor:pointer;margin-right:4px">ï¼‹</button>
            <button type="button" id="clear-location" title="Limpar seleÃ§Ã£o" aria-label="Limpar seleÃ§Ã£o" style="padding:6px 10px;background:#ff5e5e;color:white;border:none;border-radius:6px;cursor:pointer;">âœ–</button>
          </div>
          <datalist id="location-datalist"></datalist>
          <label for="reference" style="display:block;font-weight:600;font-size:13px;color:#000000;margin-bottom:6px;margin-top:4px">ğŸ• Hora de Chegada</label>
          <input type="time" id="reference" placeholder="Hora de entrada" style="width:100%;margin-bottom:10px">
          <label for="exit-time" style="display:block;font-weight:600;font-size:13px;color:#000000;margin-bottom:6px;margin-top:4px">ğŸ• Hora de SaÃ­da</label>
          <input type="time" id="exit-time" placeholder="Hora de saÃ­da" style="width:100%;margin-bottom:10px">
          <label for="route" style="display:block;font-weight:600;font-size:13px;color:#000000;margin-bottom:6px;margin-top:4px">ğŸ—ºï¸ Rota Percorrida</label>
          <input type="text" id="route" placeholder="Descreva a rota realizada" style="width:100%;margin-bottom:10px">
        </div>
        
      </div>

      <div class="card" style="margin-top:12px;background:linear-gradient(135deg,rgba(0,188,212,0.1),rgba(0,150,136,0.1));border:1px solid rgba(0,188,212,0.3)">
        <h3 class="section-title"><span>âš™ï¸ Gerenciamento</span></h3>
        <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
          <button onclick="addInspectorPrompt()" style="width:100%;padding:10px 14px;background:linear-gradient(135deg,#00bcd4,#0097a7);color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;display:flex;align-items:center;justify-content:center;gap:8px;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,188,212,0.3)">
            <span style="font-size:18px">ğŸ‘¤</span>
            <span>Adicionar Novo Inspetor</span>
          </button>
          <button onclick="addLocationPrompt()" style="width:100%;padding:10px 14px;background:linear-gradient(135deg,#00897b,#00695c);color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;display:flex;align-items:center;justify-content:center;gap:8px;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,150,136,0.3)">
            <span style="font-size:18px">ğŸ¢</span>
            <span>Adicionar Centro de Custo</span>
          </button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3 class="section-title"><span>Resumo</span></h3>
        <div id="summary" style="font-size:14px">
          <p><strong>Em Conforme:</strong> <span id="conformeCount">0</span></p>
          <p><strong>NÃ£o Conforme:</strong> <span id="naoConformeCount">0</span></p>
          <p><strong>N/A:</strong> <span id="naCount">0</span></p>
          <p><strong>Sem resposta:</strong> <span id="pendingCount">0</span></p>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="header-info">
        <h1 class="name">Checklist de FiscalizaÃ§Ã£o</h1>
        <p class="role">Sistema ARGOS â€¢ Controle de Postos</p>
        <div class="badges">
          <span class="badge">Data da fiscalizaÃ§Ã£o: <span id="current-date"></span></span>
          <span class="badge">ResponsÃ¡vel pela fiscalizaÃ§Ã£o: <span id="inspector-name">-</span></span>
          <span class="badge">Local da fiscalizaÃ§Ã£o: <span id="location-name">-</span></span>
        </div>
      </div>
      <section class="card">
        <div class="section-title">
          <h2>ğŸ“ Checklist de Perguntas</h2>
          <p>Avalie cada item conforme a situaÃ§Ã£o encontrada</p>
        </div>
        <div id="checklist-container">
          <!-- As perguntas serÃ£o geradas dinamicamente pelo JavaScript -->
        </div>
      </section>

      <section class="card">
        <div class="section-title">
          <h2>ğŸ“ Capturar LocalizaÃ§Ã£o</h2>
          <p>Capture sua localizaÃ§Ã£o exata para validar a fiscalizaÃ§Ã£o</p>
        </div>
        <div style="margin-top:16px">
          <button class="btn-primary" onclick="getGeolocation()" style="width:100%;background:linear-gradient(90deg,#ff6b9d,#c44569);font-weight:700;margin-bottom:12px">ğŸ“ Capturar LocalizaÃ§Ã£o Atual</button>
          <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1)">
            <input type="text" id="geolocation" placeholder="Aguardando captura de localizaÃ§Ã£o..." readonly style="width:100%;margin-bottom:8px;background:rgba(0,0,0,0.2);cursor:not-allowed">
            <p id="geo-status" style="font-size:12px;color:var(--muted);margin:0;min-height:20px"></p>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="section-title">
          <h2>ğŸ’¾ Salvar e Exportar</h2>
          <p>Salvar registro e gerar relatÃ³rios</p>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn-primary" onclick="saveRecord()" style="background:linear-gradient(90deg,#00e676,#00c853);font-weight:700">ğŸ’¾ Salvar Registro</button>
          <button class="btn-primary" onclick="exportToPDF()">ğŸ“„ Exportar PDF</button>
          <button class="btn-primary" onclick="exportToJSON()">ğŸ“Š Exportar JSON</button>
          <button class="btn-primary" onclick="printReport()">ğŸ–¨ï¸ Imprimir</button>
          <button class="btn-primary" onclick="resetChecklist()" style="background:linear-gradient(90deg,#ff5e5e,#ff9b9b)">ğŸ”„ Limpar Tudo</button>
        </div>
        <p id="save-status" style="margin-top:10px;font-size:13px;color:var(--muted);min-height:18px"></p>
      </section>

      <section class="card">
        <div class="section-title">
          <h2>ğŸ“ ObservaÃ§Ãµes Gerais</h2>
          <p>Adicione comentÃ¡rios ou observaÃ§Ãµes sobre a fiscalizaÃ§Ã£o</p>
        </div>
        <textarea id="general-notes" rows="5" placeholder="Digite aqui suas observaÃ§Ãµes gerais sobre a fiscalizaÃ§Ã£o..." style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.02);color:inherit;resize:vertical"></textarea>
      </section>

      <div class="footer">Â© 2025 Sistema ARGOS de FiscalizaÃ§Ã£o. Todos os direitos reservados.</div>
    </main>
  </div>

    <button id="back-to-top" onclick="scrollToTop()" style="display:none;position:fixed;bottom:20px;right:20px;padding:10px 15px;background:#00d7ff;color:white;border:none;border-radius:5px;cursor:pointer;z-index:1000">â¬†ï¸ Voltar ao topo</button>

    <script src="argos.js"></script>
    <script>
      // FunÃ§Ã£o para rolar para o topo
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // Mostrar ou ocultar o botÃ£o ao rolar a pÃ¡gina
      window.addEventListener('scroll', () => {
        const backToTopButton = document.getElementById('back-to-top');
        if (window.scrollY > window.innerHeight / 2) {
          backToTopButton.style.display = 'block';
        } else {
          backToTopButton.style.display = 'none';
        }
      });

      // FunÃ§Ã£o de logout
      function logout() {
        if (confirm('Deseja realmente sair do sistema?')) {
          sessionStorage.removeItem('argos_logged_in');
          sessionStorage.removeItem('argos_user');
          sessionStorage.removeItem('argos_tipo');
          window.location.href = 'login.html';
        }
      }
    </script>
  </body>
</html>