<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registros de Fiscaliza√ß√£o ‚Äî ARGOS</title>
  <link rel="stylesheet" href="argos.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script>
    // Firewall de autentica√ß√£o - verifica login antes de carregar a p√°gina
    (function() {
      const isLoggedIn = sessionStorage.getItem('argos_logged_in');
      if (isLoggedIn !== 'true') {
        window.location.href = 'login.html';
      }
    })();
  </script>
</head>
<body>
  <script>
    // Verificar tipo de usu√°rio para controlar permiss√µes
    const userType = sessionStorage.getItem('argos_tipo');
    const isFiscal = userType === 'fiscal';
  </script>
  <div class="container">
    <aside class="profile card">
      <div class="avatar">
        <img src="arg/Logo-Argosvig-2-e1745505100362.webp" alt="Logo ARGOS" style="width:100%;height:100%;object-fit:contain;border-radius:12px;">
      </div>

      <div class="card">
        <h3 class="section-title"><span>Navega√ß√£o</span></h3>
        <div style="margin-top:12px;display:flex;flex-direction:column;gap:10px">
          <div id="user-type-badge-registros" style="background:rgba(0,212,255,0.15);color:#00d4ff;padding:8px 12px;border-radius:8px;margin-bottom:8px;text-align:center;font-size:12px;font-weight:600;border:1px solid rgba(0,212,255,0.3)"></div>
          <a href="index.html" class="nav-link">üìã Nova Fiscaliza√ß√£o</a>
          <a href="registros.html" class="nav-link active">üìä Registros</a>
          <button onclick="logout()" class="nav-link" style="width:100%;text-align:left;background:rgba(255,94,94,0.1);color:#ff5e5e;border:none;cursor:pointer;padding:10px 16px;border-radius:8px;font-size:14px;font-weight:500;margin-top:8px;">üö™ Sair</button>
        </div>
        
        <script>
          // Exibir tipo de usu√°rio
          const userTypeBadgeReg = document.getElementById('user-type-badge-registros');
          const userNameReg = sessionStorage.getItem('argos_user');
          const userTypeReg = sessionStorage.getItem('argos_tipo');
          if (userTypeBadgeReg) {
            if (userTypeReg === 'admin') {
              userTypeBadgeReg.innerHTML = 'üë§ ' + (userNameReg || 'Admin').toUpperCase() + ' - ADMIN';
              userTypeBadgeReg.style.background = 'rgba(0,230,118,0.15)';
              userTypeBadgeReg.style.color = '#00e676';
              userTypeBadgeReg.style.borderColor = 'rgba(0,230,118,0.3)';
            } else {
              userTypeBadgeReg.innerHTML = 'üëÅÔ∏è ' + (userNameReg || 'Fiscal').toUpperCase() + ' - FISCAL';
              userTypeBadgeReg.style.background = 'rgba(255,152,0,0.15)';
              userTypeBadgeReg.style.color = '#ff9800';
              userTypeBadgeReg.style.borderColor = 'rgba(255,152,0,0.3)';
            }
          }
        </script>
      </div>

      <div class="card" style="margin-top:12px">
        <h3 class="section-title"><span>Estat√≠sticas Gerais</span></h3>
        <div id="stats-summary" style="font-size:14px">
          <p><strong>Total de Registros:</strong> <span id="totalRecords">0</span></p>
          <p><strong>Total de N√£o Conformes:</strong> <span id="totalNonConform">0</span></p>
          <p><strong>Postos Fiscalizados:</strong> <span id="totalLocations">0</span></p>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3 class="section-title"><span>Filtros</span></h3>
        <div style="margin-top:12px">
          <select id="filterLocation" style="width:100%;margin-bottom:10px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.02);color:#000000">
            
          </select>
          <input type="date" id="filterDate" style="width:100%;margin-bottom:10px">
          <button class="btn-primary" onclick="applyFilters()" style="width:100%">üîç Filtrar</button>
          <button class="btn-primary" onclick="clearFilters()" style="width:100%;margin-top:5px;background:rgba(255,255,255,0.1)">‚úï Limpar</button>
        </div>
    </div>
    </aside>

    <main class="main">
      <div class="header-info">
        <h1 class="name">Registros de Fiscaliza√ß√£o</h1>
        <p class="role">Sistema ARGOS ‚Ä¢ An√°lise de Dados</p>
      </div>
      
      <script>
        // Adicionar mensagem para usu√°rio fiscal
        if (sessionStorage.getItem('argos_tipo') === 'fiscal') {
          const headerInfo = document.querySelector('.header-info');
          const alertDiv = document.createElement('div');
          alertDiv.style.cssText = 'background:rgba(255,152,0,0.15);border:2px solid #ff9800;color:#ff9800;padding:12px 16px;border-radius:10px;margin-top:16px;text-align:center;font-weight:600;font-size:14px';
          alertDiv.innerHTML = '‚ö†Ô∏è MODO SOMENTE LEITURA - Voc√™ pode visualizar e exportar registros, mas n√£o pode excluir ou importar dados';
          headerInfo.appendChild(alertDiv);
        }
      </script>

      <section class="card">
        <div class="section-title">
          <h2>üìä Gr√°fico: Postos com Mais Registros</h2>
          <p>An√°lise de frequ√™ncia de fiscaliza√ß√µes por local</p>
        </div>
        <div style="position:relative;height:300px;margin-top:20px">
          <canvas id="chartLocations"></canvas>
        </div>
      </section>

      <section class="card">
        <div class="section-title">
          <h2>üë§ Gr√°fico: Supervisores com Mais Registros</h2>
          <p>Fiscais com maior n√∫mero de fiscaliza√ß√µes realizadas</p>
        </div>
        <div style="position:relative;height:300px;margin-top:20px">
          <canvas id="chartInspectors"></canvas>
        </div>
      </section>

      

      <section class="card">
        <div class="section-title">
          <h2>üìã Hist√≥rico de Registros</h2>
          <p>Todas as fiscaliza√ß√µes realizadas</p>
        </div>
        <div style="margin-top:20px;display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap">
          <button class="btn-primary" onclick="openImportModal()">üì§ Importar Registros</button>
          <button class="btn-primary" onclick="exportAllToJSON()">üì• Exportar JSON</button>
          <button class="btn-primary" onclick="exportAllToPDF()" style="background:linear-gradient(90deg,#ff6b9d,#c44569)">üìÑ Exportar Todos PDF</button>
          <button class="btn-primary" onclick="clearAllRecords()" style="background:linear-gradient(90deg,#ff5e5e,#ff9b9b)">üóëÔ∏è Limpar Tudo</button>
        </div>
        <div style="display:grid;grid-template-columns:300px 1fr;gap:16px">
          <!-- Sidebar com cards dos registros -->
          <div id="records-sidebar" style="max-height:800px;overflow-y:auto;padding-right:8px">
            <!-- Cards resumidos aparecer√£o aqui -->
          </div>
          <!-- √Årea de detalhes do registro selecionado -->
          <div id="record-details" style="min-height:400px">
            <p style="text-align:center;color:var(--muted);padding:40px">Selecione um registro ao lado para ver os detalhes</p>
          </div>
        </div>
      </section>

      <!-- Modal de Importa√ß√£o -->
      <div id="importModal" class="modal-overlay" style="display:none" onclick="closeImportModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeImportModal()">‚úï</button>
          <h2>üì§ Importar Registros</h2>
          
          <div style="margin:20px 0">
            <p style="color:var(--muted);margin-bottom:15px">Selecione um arquivo JSON com registros de fiscaliza√ß√£o para importar:</p>
            
            <input type="file" id="importFileInput" accept=".json" style="display:none" onchange="handleFileImport(event)">
            <button class="btn-primary" onclick="document.getElementById('importFileInput').click()" style="width:100%;padding:15px;font-size:16px">
              üìÅ Selecionar Arquivo JSON
            </button>
          </div>
          
          <div id="importPreview" style="display:none;margin-top:20px">
            <h3 style="color:var(--accent);margin-bottom:10px">Pr√©via dos Registros</h3>
            <div id="importInfo" style="background:rgba(255,255,255,0.02);padding:15px;border-radius:8px;margin-bottom:15px"></div>
            
            <div style="display:flex;gap:10px">
              <button class="btn-primary" onclick="confirmImport()" style="flex:1">‚úÖ Confirmar Importa√ß√£o</button>
              <button class="btn-primary" onclick="cancelImport()" style="flex:1;background:rgba(255,255,255,0.1)">‚ùå Cancelar</button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">¬© 2025 Sistema ARGOS de Fiscaliza√ß√£o. Todos os direitos reservados.</div>
    </main>
  </div>

    <script src="registros.js"></script>
    <script>
      // Fun√ß√£o de logout
      function logout() {
        if (confirm('Deseja realmente sair do sistema?')) {
          sessionStorage.removeItem('argos_logged_in');
          sessionStorage.removeItem('argos_user');
          sessionStorage.removeItem('argos_tipo');
          window.location.href = 'login.html';
        }
      }
    </script>
  </body>
</html>
